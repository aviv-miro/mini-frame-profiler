!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.miniFrameProfiler=t():e.miniFrameProfiler=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{measureFramesWithTimer:()=>a});var n,r=function(){function e(e){this.sortedFrameTimes=[],this.median=null,this.mean=null,this.p99=null,this.p95=null,this.zScores=null,this.zScoresMean=null,this.stdDev=null,this.frameTimes=Array.isArray(e)?e:e.frameTimes,this.sortedFrameTimes=this.frameTimes.slice().sort((function(e,t){return e-t})),this.median=this.calcMedian(),this.p99=this.calcPercentile(99),this.p95=this.calcPercentile(95),this.mean=this.calcMean(),this.stdDev=this.calcStdDev(),this.zScores=this.calcZScores(),this.zScoresMean=this.calcZScoresMean()}return e.prototype.calcPercentile=function(e){var t=Math.floor(this.sortedFrameTimes.length*(e/100));return this.sortedFrameTimes[t]},e.prototype.calcMedian=function(){return this.calcPercentile(50)},e.prototype.calcMean=function(){for(var e=0,t=0;t<this.frameTimes.length;t++)e+=this.frameTimes[t];return e/this.frameTimes.length},e.prototype.calcStdDev=function(){for(var e=this.mean||this.calcMean(),t=0,n=0;n<this.frameTimes.length;n++)t+=Math.pow(this.frameTimes[n]-e,2);return Math.sqrt(t/this.frameTimes.length)},e.prototype.calcZScores=function(){for(var e=this.mean||this.calcMean(),t=this.stdDev||this.calcStdDev(),n=[],r=0;r<this.frameTimes.length;r++)n.push((this.frameTimes[r]-e)/t);return n},e.prototype.calcZScoresMean=function(){for(var e=0,t=0;t<this.zScores.length;t++)e+=this.zScores[t];return e/this.zScores.length},e.prototype.filterOutliersByZScore=function(t){var n=this;return void 0===t&&(t=2),new e(this.frameTimes.filter((function(e,r){return Math.abs(n.zScores[r])<t})))},e.prototype.getStatistics=function(){return{p95:this.p95,p99:this.p99,mean:this.mean,median:this.median,stdDev:this.stdDev,zScoresMean:this.zScoresMean}},e}(),i=function(){function e(){this.frameTimes=[],this.lastTime=1/0,this.isMeasuring=!1}return e.prototype.start=function(){this.isMeasuring||(this.isMeasuring=!0,this.measure())},e.prototype.stop=function(){this.isMeasuring=!1,this.lastTime=1/0},e.prototype.statistics=function(){if(!this.isMeasuring)return new r(this.frameTimes);console.warn("You should stop measuring before getting statistics.")},e.prototype.measure=function(){var e=this;if(this.isMeasuring){requestAnimationFrame((function(){return e.measure()}));var t=performance.now();this.lastTime>t||this.frameTimes.push(t-this.lastTime),this.lastTime=t}},e.measureFramesWithTimer=function(){return t=this,n=arguments,i=function(t,n){var r,i,o;return void 0===t&&(t=5),void 0===n&&(n=0),function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(s){return r=new e,i=1e3*t,o=1e3*n,console.log("Measuring frames for ".concat(t," seconds, starting in ").concat(n," seconds...")),[2,new Promise((function(e){setTimeout((function(){console.log("Starting measuring frames."),r.start(),setTimeout((function(){r.stop(),console.log("Finished measuring frames."),e(r)}),i)}),o)}))]}))},new((r=void 0)||(r=Promise))((function(e,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}c((i=i.apply(t,n||[])).next())}));var t,n,r,i},e}(),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){s.label=a[1];break}if(6===a[0]&&s.label<i[1]){s.label=i[1],i=a;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function a(e,t){return o(this,void 0,void 0,(function(){return s(this,(function(n){return[2,i.measureFramesWithTimer(e,t)]}))}))}return n=function(){console.log('Library "miniFrameProfiler" is ready!'),window.MFP=window.miniFrameProfiler},"complete"!==document.readyState?window.addEventListener("load",(function(){return n&&n()})):n&&n(),t})()));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QXNCLFdBQU0sU0FBS0wsU0FBTCxJQUU1QixJQUFJTSxFQUFNQyxZQUFZRCxNQUNsQmxFLEtBQUt3RCxTQUFXVSxHQUlwQmxFLEtBQUtrQixXQUFXOEIsS0FBS2tCLEVBQU1sRSxLQUFLd0QsVUFIOUJ4RCxLQUFLd0QsU0FBV1UsQ0FMVyxDQVUvQixFQUVhLEVBQUFFLHVCQUFiLFcscUNBQ0VDLEVBQ0FDLEcsc0JBREEsSUFBQUQsSUFBQUEsRUFBQSxRQUNBLElBQUFDLElBQUFBLEVBQUEsRyw0a0NBUUEsT0FOSUMsRUFBZSxJQUFJQyxFQUNqQkMsRUFBOEIsSUFBaEJKLEVBQ2RLLEVBQTZCLElBQWpCSixFQUNsQlAsUUFBUVksSUFDTiwrQkFBd0JOLEVBQWEsaUNBQXlCQyxFQUFjLGdCQUV2RSxDQUFQLEVBQU8sSUFBSU0sU0FBUSxTQUFDQyxHQUNsQkMsWUFBVyxXQUNUZixRQUFRWSxJQUFJLDhCQUNaSixFQUFhWixRQUNibUIsWUFBVyxXQUNUUCxFQUFhVixPQUNiRSxRQUFRWSxJQUFJLDhCQUNaRSxFQUFRTixFQUNWLEdBQUdFLEVBQ0wsR0FBR0MsRUFDTCxJLHFTQUVKLEVBM0RBLEcsazJDQ1VPLFNBQWVOLEVBQ3BCQyxFQUNBQyxHLG1FQUVBLE1BQU8sQ0FBUCxFQUFPRSxFQUFhSix1QkFBdUJDLEVBQWVDLEcsY0ZadkNyRCxFRUVyQixXQUNFOEMsUUFBUVksSUFBSSx5Q0FFWkksT0FBT0MsSUFBTUQsT0FBT0UsaUJBQ3RCLEVGTDhCLGFBQXhCQyxTQUFTQyxXQUNYSixPQUFPSyxpQkFBaUIsUUFBUSxXQUFNLE9BQUFuRSxHQUFNQSxHQUFOLElBRXRDQSxHQUFNQSxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbWluaUZyYW1lUHJvZmlsZXIvd2VicGFjay91bml2ZXJzYWxNb2R1bGVEZWZpbml0aW9uIiwid2VicGFjazovL21pbmlGcmFtZVByb2ZpbGVyL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL21pbmlGcmFtZVByb2ZpbGVyL3dlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyIsIndlYnBhY2s6Ly9taW5pRnJhbWVQcm9maWxlci93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL21pbmlGcmFtZVByb2ZpbGVyL3dlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QiLCJ3ZWJwYWNrOi8vbWluaUZyYW1lUHJvZmlsZXIvLi9zcmMvRnJhbWVTdGF0aXN0aWNzLnRzIiwid2VicGFjazovL21pbmlGcmFtZVByb2ZpbGVyLy4vc3JjL2luaXQudHMiLCJ3ZWJwYWNrOi8vbWluaUZyYW1lUHJvZmlsZXIvLi9zcmMvTWVhc3VyZUZyYW1lLnRzIiwid2VicGFjazovL21pbmlGcmFtZVByb2ZpbGVyLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIm1pbmlGcmFtZVByb2ZpbGVyXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIm1pbmlGcmFtZVByb2ZpbGVyXCJdID0gZmFjdG9yeSgpO1xufSkodGhpcywgKCkgPT4ge1xucmV0dXJuICIsIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4ge1xuXHRmb3IodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7XG5cdFx0aWYoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7XG5cdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pO1xuXHRcdH1cblx0fVxufTsiLCJfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkpIiwiLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHtcblx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG5cdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG5cdH1cblx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbn07IiwiaW1wb3J0IHsgTWVhc3VyZUZyYW1lIH0gZnJvbSBcIi4vTWVhc3VyZUZyYW1lXCI7XG5pbXBvcnQgeyBURnJhbWVzU3RhdGlzdGljcyB9IGZyb20gXCIuL1RGcmFtZXNTdGF0aXN0aWNzXCI7XG5cbmV4cG9ydCBjbGFzcyBGcmFtZVN0YXRpc3RpY3Mge1xuICBmcmFtZVRpbWVzOiBudW1iZXJbXTtcbiAgc29ydGVkRnJhbWVUaW1lczogbnVtYmVyW10gPSBbXTtcbiAgbWVkaWFuOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgbWVhbjogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHA5OTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHA5NTogbnVtYmVyIHwgbnVsbCA9IG51bGw7XG4gIHpTY29yZXM6IG51bWJlcltdIHwgbnVsbCA9IG51bGw7XG4gIHpTY29yZXNNZWFuOiBudW1iZXIgfCBudWxsID0gbnVsbDtcbiAgc3RkRGV2OiBudW1iZXIgfCBudWxsID0gbnVsbDtcblxuICBjb25zdHJ1Y3RvcihmcmFtZVRpbWVzOiBNZWFzdXJlRnJhbWUgfCBudW1iZXJbXSkge1xuICAgIHRoaXMuZnJhbWVUaW1lcyA9IEFycmF5LmlzQXJyYXkoZnJhbWVUaW1lcylcbiAgICAgID8gZnJhbWVUaW1lc1xuICAgICAgOiBmcmFtZVRpbWVzLmZyYW1lVGltZXM7XG4gICAgdGhpcy5zb3J0ZWRGcmFtZVRpbWVzID0gdGhpcy5mcmFtZVRpbWVzLnNsaWNlKCkuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICAgIHRoaXMubWVkaWFuID0gdGhpcy5jYWxjTWVkaWFuKCk7XG4gICAgdGhpcy5wOTkgPSB0aGlzLmNhbGNQZXJjZW50aWxlKDk5KTtcbiAgICB0aGlzLnA5NSA9IHRoaXMuY2FsY1BlcmNlbnRpbGUoOTUpO1xuICAgIHRoaXMubWVhbiA9IHRoaXMuY2FsY01lYW4oKTtcbiAgICB0aGlzLnN0ZERldiA9IHRoaXMuY2FsY1N0ZERldigpO1xuICAgIHRoaXMuelNjb3JlcyA9IHRoaXMuY2FsY1pTY29yZXMoKTtcbiAgICB0aGlzLnpTY29yZXNNZWFuID0gdGhpcy5jYWxjWlNjb3Jlc01lYW4oKTtcbiAgfVxuXG4gIGNhbGNQZXJjZW50aWxlKHBlcmNlbnRpbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnNvcnRlZEZyYW1lVGltZXMubGVuZ3RoICogKHBlcmNlbnRpbGUgLyAxMDApKTtcbiAgICByZXR1cm4gdGhpcy5zb3J0ZWRGcmFtZVRpbWVzW2luZGV4XTtcbiAgfVxuXG4gIGNhbGNNZWRpYW4oKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jYWxjUGVyY2VudGlsZSg1MCk7XG4gIH1cblxuICBjYWxjTWVhbigpOiBudW1iZXIge1xuICAgIC8vIHVzaW5nIGEgcmVndWxhciBmb3IgbG9vcCBpbnN0ZWFkIG9mIHJlZHVjZSB0byBhdm9pZCBlcnJvcnMgd2hlbiB0aGUgYXJyYXkgaXMgYmlnZ2VyIHRoYW4gdGhlIGNhbGwgc3RhY2tcbiAgICBsZXQgc3VtID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZnJhbWVUaW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgc3VtICs9IHRoaXMuZnJhbWVUaW1lc1tpXTtcbiAgICB9XG4gICAgcmV0dXJuIHN1bSAvIHRoaXMuZnJhbWVUaW1lcy5sZW5ndGg7XG4gIH1cblxuICBjYWxjU3RkRGV2KCk6IG51bWJlciB7XG4gICAgbGV0IG1lYW4gPSB0aGlzLm1lYW4gfHwgdGhpcy5jYWxjTWVhbigpO1xuICAgIGxldCBzdW0gPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mcmFtZVRpbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdW0gKz0gTWF0aC5wb3codGhpcy5mcmFtZVRpbWVzW2ldIC0gbWVhbiwgMik7XG4gICAgfVxuICAgIHJldHVybiBNYXRoLnNxcnQoc3VtIC8gdGhpcy5mcmFtZVRpbWVzLmxlbmd0aCk7XG4gIH1cblxuICBjYWxjWlNjb3JlcygpOiBudW1iZXJbXSB7XG4gICAgY29uc3QgbWVhbiA9IHRoaXMubWVhbiB8fCB0aGlzLmNhbGNNZWFuKCk7XG4gICAgY29uc3Qgc3RkRGV2ID0gdGhpcy5zdGREZXYgfHwgdGhpcy5jYWxjU3RkRGV2KCk7XG4gICAgY29uc3QgelNjb3JlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5mcmFtZVRpbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB6U2NvcmVzLnB1c2goKHRoaXMuZnJhbWVUaW1lc1tpXSAtIG1lYW4pIC8gc3RkRGV2KTtcbiAgICB9XG4gICAgcmV0dXJuIHpTY29yZXM7XG4gIH1cblxuICBjYWxjWlNjb3Jlc01lYW4oKTogbnVtYmVyIHtcbiAgICBsZXQgc3VtID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuelNjb3JlcyEubGVuZ3RoOyBpKyspIHtcbiAgICAgIHN1bSArPSB0aGlzLnpTY29yZXMhW2ldO1xuICAgIH1cbiAgICByZXR1cm4gc3VtIC8gdGhpcy56U2NvcmVzIS5sZW5ndGg7XG4gIH1cblxuICBmaWx0ZXJPdXRsaWVyc0J5WlNjb3JlKHRocmVzaG9sZDogbnVtYmVyID0gMik6IEZyYW1lU3RhdGlzdGljcyB7XG4gICAgY29uc3QgZmlsdGVyZWRGcmFtZVRpbWVzID0gdGhpcy5mcmFtZVRpbWVzLmZpbHRlcihcbiAgICAgIChfLCBpKSA9PiBNYXRoLmFicyh0aGlzLnpTY29yZXMhW2ldKSA8IHRocmVzaG9sZCxcbiAgICApO1xuICAgIHJldHVybiBuZXcgRnJhbWVTdGF0aXN0aWNzKGZpbHRlcmVkRnJhbWVUaW1lcyk7XG4gIH1cblxuICBnZXRTdGF0aXN0aWNzKCk6IFRGcmFtZXNTdGF0aXN0aWNzIHtcbiAgICByZXR1cm4ge1xuICAgICAgcDk1OiB0aGlzLnA5NSxcbiAgICAgIHA5OTogdGhpcy5wOTksXG4gICAgICBtZWFuOiB0aGlzLm1lYW4sXG4gICAgICBtZWRpYW46IHRoaXMubWVkaWFuLFxuICAgICAgc3RkRGV2OiB0aGlzLnN0ZERldixcbiAgICAgIHpTY29yZXNNZWFuOiB0aGlzLnpTY29yZXNNZWFuLFxuICAgIH07XG4gIH1cbn1cbiIsIi8qKlxuICogRmlyZXMgYSBjYWxsYmFjayBmdW5jdGlvbiBhZnRlciB0aGUgd2luZG93IGhhcyBiZWVuIGxvYWRlZC5cbiAqIEBwYXJhbSBjYlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdChjYj86ICguLi5hcmdzOiBhbnlbXSkgPT4gdm9pZCkge1xuICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSAhPT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IGNiICYmIGNiKCkpO1xuICB9IGVsc2Uge1xuICAgIGNiICYmIGNiKCk7XG4gIH1cbn1cbiIsImltcG9ydCB7IEZyYW1lU3RhdGlzdGljcyB9IGZyb20gXCIuL0ZyYW1lU3RhdGlzdGljc1wiO1xuXG5leHBvcnQgY2xhc3MgTWVhc3VyZUZyYW1lIHtcbiAgZnJhbWVUaW1lczogbnVtYmVyW10gPSBbXTtcbiAgbGFzdFRpbWU6IG51bWJlciA9IEluZmluaXR5O1xuICBpc01lYXN1cmluZzogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIHN0YXJ0KCkge1xuICAgIGlmICh0aGlzLmlzTWVhc3VyaW5nKSByZXR1cm47XG4gICAgdGhpcy5pc01lYXN1cmluZyA9IHRydWU7XG4gICAgdGhpcy5tZWFzdXJlKCk7XG4gIH1cblxuICBzdG9wKCkge1xuICAgIHRoaXMuaXNNZWFzdXJpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmxhc3RUaW1lID0gSW5maW5pdHk7XG4gIH1cblxuICBzdGF0aXN0aWNzKCk6IEZyYW1lU3RhdGlzdGljcyB8IHZvaWQge1xuICAgIGlmICh0aGlzLmlzTWVhc3VyaW5nKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJZb3Ugc2hvdWxkIHN0b3AgbWVhc3VyaW5nIGJlZm9yZSBnZXR0aW5nIHN0YXRpc3RpY3MuXCIpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IEZyYW1lU3RhdGlzdGljcyh0aGlzLmZyYW1lVGltZXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBtZWFzdXJlKCkge1xuICAgIGlmICghdGhpcy5pc01lYXN1cmluZykgcmV0dXJuO1xuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB0aGlzLm1lYXN1cmUoKSk7XG5cbiAgICBsZXQgbm93ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgaWYgKHRoaXMubGFzdFRpbWUgPiBub3cpIHtcbiAgICAgIHRoaXMubGFzdFRpbWUgPSBub3c7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZnJhbWVUaW1lcy5wdXNoKG5vdyAtIHRoaXMubGFzdFRpbWUpO1xuICAgIHRoaXMubGFzdFRpbWUgPSBub3c7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgbWVhc3VyZUZyYW1lc1dpdGhUaW1lcihcbiAgICB0aW1lSW5TZWNvbmRzOiBudW1iZXIgPSA1LFxuICAgIGRlbGF5SW5TZWNvbmRzOiBudW1iZXIgPSAwLFxuICApOiBQcm9taXNlPE1lYXN1cmVGcmFtZT4ge1xuICAgIGxldCBtZWFzdXJlRnJhbWUgPSBuZXcgTWVhc3VyZUZyYW1lKCk7XG4gICAgY29uc3QgbWVhc3VyZVRpbWUgPSB0aW1lSW5TZWNvbmRzICogMTAwMDtcbiAgICBjb25zdCBkZWxheVRpbWUgPSBkZWxheUluU2Vjb25kcyAqIDEwMDA7XG4gICAgY29uc29sZS5sb2coXG4gICAgICBgTWVhc3VyaW5nIGZyYW1lcyBmb3IgJHt0aW1lSW5TZWNvbmRzfSBzZWNvbmRzLCBzdGFydGluZyBpbiAke2RlbGF5SW5TZWNvbmRzfSBzZWNvbmRzLi4uYCxcbiAgICApO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RhcnRpbmcgbWVhc3VyaW5nIGZyYW1lcy5cIik7XG4gICAgICAgIG1lYXN1cmVGcmFtZS5zdGFydCgpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBtZWFzdXJlRnJhbWUuc3RvcCgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmluaXNoZWQgbWVhc3VyaW5nIGZyYW1lcy5cIik7XG4gICAgICAgICAgcmVzb2x2ZShtZWFzdXJlRnJhbWUpO1xuICAgICAgICB9LCBtZWFzdXJlVGltZSk7XG4gICAgICB9LCBkZWxheVRpbWUpO1xuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBpbml0IH0gZnJvbSBcIi4vaW5pdFwiO1xuaW1wb3J0IHsgTWVhc3VyZUZyYW1lIH0gZnJvbSBcIi4vTWVhc3VyZUZyYW1lXCI7XG5cbi8qKiBQbGVhc2UgZmVlbCBmcmVlIHRvIGNoYW5nZSB0aGlzIGZpbGUgYXMgeW91IHNlZSBmaXQuICovXG4vKiogdGhlc2UgYXJlIG9ubHkgZXhhbXBsZXMgKi9cblxuZnVuY3Rpb24gcmVhZHkoKSB7XG4gIGNvbnNvbGUubG9nKCdMaWJyYXJ5IFwibWluaUZyYW1lUHJvZmlsZXJcIiBpcyByZWFkeSEnKTtcbiAgLy8gQHRzLWlnbm9yZVxuICB3aW5kb3cuTUZQID0gd2luZG93Lm1pbmlGcmFtZVByb2ZpbGVyO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWVhc3VyZUZyYW1lc1dpdGhUaW1lcihcbiAgdGltZUluU2Vjb25kcz86IG51bWJlcixcbiAgZGVsYXlJblNlY29uZHM/OiBudW1iZXIsXG4pOiBQcm9taXNlPE1lYXN1cmVGcmFtZT4ge1xuICByZXR1cm4gTWVhc3VyZUZyYW1lLm1lYXN1cmVGcmFtZXNXaXRoVGltZXIodGltZUluU2Vjb25kcywgZGVsYXlJblNlY29uZHMpO1xufVxuXG5pbml0KHJlYWR5KTtcbiJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ0aGlzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJjYiIsImZyYW1lVGltZXMiLCJzb3J0ZWRGcmFtZVRpbWVzIiwibWVkaWFuIiwibWVhbiIsInA5OSIsInA5NSIsInpTY29yZXMiLCJ6U2NvcmVzTWVhbiIsInN0ZERldiIsIkFycmF5IiwiaXNBcnJheSIsInNsaWNlIiwic29ydCIsImEiLCJiIiwiY2FsY01lZGlhbiIsImNhbGNQZXJjZW50aWxlIiwiY2FsY01lYW4iLCJjYWxjU3RkRGV2IiwiY2FsY1pTY29yZXMiLCJjYWxjWlNjb3Jlc01lYW4iLCJwZXJjZW50aWxlIiwiaW5kZXgiLCJNYXRoIiwiZmxvb3IiLCJsZW5ndGgiLCJzdW0iLCJpIiwicG93Iiwic3FydCIsInB1c2giLCJmaWx0ZXJPdXRsaWVyc0J5WlNjb3JlIiwidGhyZXNob2xkIiwiRnJhbWVTdGF0aXN0aWNzIiwiZmlsdGVyIiwiXyIsImFicyIsImdldFN0YXRpc3RpY3MiLCJsYXN0VGltZSIsIkluZmluaXR5IiwiaXNNZWFzdXJpbmciLCJzdGFydCIsIm1lYXN1cmUiLCJzdG9wIiwic3RhdGlzdGljcyIsImNvbnNvbGUiLCJ3YXJuIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibm93IiwicGVyZm9ybWFuY2UiLCJtZWFzdXJlRnJhbWVzV2l0aFRpbWVyIiwidGltZUluU2Vjb25kcyIsImRlbGF5SW5TZWNvbmRzIiwibWVhc3VyZUZyYW1lIiwiTWVhc3VyZUZyYW1lIiwibWVhc3VyZVRpbWUiLCJkZWxheVRpbWUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJNRlAiLCJtaW5pRnJhbWVQcm9maWxlciIsImRvY3VtZW50IiwicmVhZHlTdGF0ZSIsImFkZEV2ZW50TGlzdGVuZXIiXSwic291cmNlUm9vdCI6IiJ9